---
title: "Project 2 - Group 2"
author: "Dorothee Mersch"
date: "5 Juni 2019"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
## Load Data
The given data is integrated as follows:
```{r}
treated <- readRDS("C:/Users/Dori/Documents/NCI_TPW_gep_treated.rds")
untreated <- readRDS("C:/Users/Dori/Documents/NCI_TPW_gep_untreated.rds")
ic50 <- readRDS("C:/Users/Dori/Documents/NegLogGI50.rds")
basalexp <- readRDS("C:/Users/Dori/Documents/CCLE_basalexpression.rds")
copynumber <- readRDS("C:/Users/Dori/Documents/CCLE_copynumber.rds")
mutations <- readRDS("C:/Users/Dori/Documents/CCLE_mutations.rds")
cellline <- read.delim("C:/Users/Dori/Documents/cellline_annotation.tsv", header = TRUE, sep = "\t")
meta <- read.delim("C:/Users/Dori/Documents/cellline_annotation.tsv", header = TRUE, sep = "\t")
drug <- read.delim("C:/Users/Dori/Documents/drug_annotation.tsv", header = TRUE, sep = "\t")
```
## Remove NAs
In order to clean up our data, we created a loop for checking the amount of NAs in every matrix. Then, two coloumns, which only contained of NAs were removed out of the mutations matrix.
```{r}
list.na = list("treated"=treated, "untreated"=untreated, "mutations"=mutations, "basalexp" = basalexp, "cellline"=cellline, "copynumber"=copynumber, "ic50"=ic50, "meta"=meta)
myfunc = function(x){sum(is.na(x))}

i = 0
while(i<9)
{
  p=sapply(list.na[i],myfunc)
  print(p)
  i = i +1
}

mutations.removed = mutations[, -(12:13)]
```
## Scaling
For normalizing our data, scale was used. 
```{r}
#scale
basal.scaled <- scale(basalexp)
treated.scaled <- scale(treated)
untreated.scaled <- scale(untreated)
```

## Coloring every drug
In order to color following plots with a different color for each drug a vector was created. 
```{r}
colorvector = c("firebrick", "forestgreen", "blue", "orange", "black", "lightblue", "pink", "violet", "grey", "lightgreen", "navy", "gold", "yellow", "red", "peru")
drugnames <- drug
rownames(drugnames) = drugnames$Drug
drugcolor <- cbind(colorvector, rownames(drugnames))
drugcolorvector <- sapply(rownames(meta), function(x){
   unname(drugcolor[meta[x, 3]], force = FALSE)
 })
```

## Boxplot treated without scaling
In order to get an overview a boxplot of the treated data was computed. There was a visible difference between the 15 batches. 
###each drug is colored in a different color
```{r}
boxplot(treated, xlab = "Samples", horizontal = F, main = "Gene Expression Treated")
```

## Boxplot treated with scaling
Through scaling the data the different batches dissapeared.
####color
```{r}
boxplot(treated.scaled, xlab="Samples", horizontal = F, main = "Gene Expression Treated Scaled")
```

## Fold Change Treated/Untreated
In order to analyse the gene expression change from untreated to treated, log2 fold change values were computed. The distribution was checked through a density plot.
```{r}
log2FC.treated.untreated <- log2(treated.scaled/untreated.scaled)
is.nan.data.frame <- function(x)      #NaN durch 0 ersetzen
  do.call(cbind, lapply(x, is.nan))
log2FC.treated.untreated[is.nan(log2FC.treated.untreated)] <- 0
plot(density(log2FC.treated.untreated), main = "Log2 FC Treated/Untreated")
```

## PCA
For a dimensional reduction, a principal component analysis was performed. The PCA was interpreted by plotting the first four components and coloring different groups of data.
First chemotherapeutics and targeted drugs were colored in both plots. This did not seperate the data in visible groups. 
Next each drug was colored in a different color, the color scheme remained the same as bevore. Here PC3 and PC4 seem to seperate the diffenrent drugs. Especially vorinostat was seperated from the rest of the data.
Lastly 4 tyrosine kinase inhibitors drugs were colored. There was no seperation visible.
```{r}
PCA.FC <- prcomp(log2FC.treated.untreated, center=F , scale.=F)
plot(PCA.FC, type ="lines")
plot(PCA.FC$rotation[, 1], PCA.FC$rotation[, 2], xlab = "PC1", ylab = "PC2", pch=19, main = "PCA Treated/Untreated")
plot(PCA.FC$rotation[, 3], PCA.FC$rotation[, 4], xlab = "PC3", ylab = "PC4", pch = 19, main = "Treated/Untreated")
```

## How many variance can be explained by the principle components?
```{r}
Varianz.PCA=PCA.FC$sdev^2
```
