---
title: "Linear Regression"
author: "Dorothee Mersch"
date: "8 Juli 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Linear Regression Analysis
The RGES values of the paper (QUELLE) positively correlate with drug sensitivity. We want to check, whether our previously computed RGES values also correlate with our IC50 data. 
Afterwards a linear regression model is performed in order to predict drug sensitivity of various cell lines with RGES values. RGES is a value, which measures the drugs potency to reverse a disease induced gene expression.
First the data set was limited to numerical values, as well as the drug sensitivity values were converted as they were in -log10 scale.
A data frame with RGES and IC50 values is contained.
```{r, echo=FALSE}
### load the data
drug_activity_rges = readRDS("C:/Users/Dori/Desktop/Studium/SS_19/Bioinfo Projekt/GitHub/project-02-group-02#project-02-group-02/data/drug_activity_rges.rds")


# limit the data set to numerical values, convert IC50 values as they are in -log10 scale
#keine ahnung ob das sinn macht, was ich hier getan habe?
ic50 = drug_activity_rges[,9]
IC50.value = -10^ic50
RGES = drug_activity_rges[,2]
rges.ic50 <- as.data.frame(cbind(RGES, IC50.value))
```
First we want to check the correlation between the computed RGES values and our drug sensitivity values.
```{r, echo = TRUE}
cor(rges.ic50$RGES, rges.ic50$IC50.value)
# check significance
cor.test(rges.ic50$RGES, rges.ic50$IC50.value)
```

The linear regression model should be learned on a training set. The training set is formed by 200 random variables of the data set. The other part of the data set than is called test set. 
It was checked, whether the residuals are normal distributed and wheter they correlate with x-values.

```{r, echo = TRUE}
i.train = sample(1:nrow(rges.ic50), 200)
rges.ic50.train = rges.ic50[i.train, ]
rges.ic50.test = rges.ic50[-i.train, ]
#learn lm on training set
l.train = lm(IC50.value ~ RGES, data = rges.ic50.train)
summary(l.train)
```
```{r, echo = FALSE}
# normal distribution of residuals?
hist(l.train$residuals, breaks = 20)
qqnorm(l.train$residuals)
qqline(l.train$residuals)
## correlation residuals x-values?
cor(rges.ic50.train$RGES, l.train$residuals)
```

Finally the training set was used to predict drug sensitivity with RGES values.
To check the models potency, the RMSE values for the training set as well as for the test set were computed.
```{r, echo = TRUE}
pred = predict(l.train, newdata = rges.ic50.test)

#compute RMSE
n = nrow(rges.ic50.train)
rmse.train = sqrt(1/n * sum(l.train$residuals^2))
rmse.train
n = nrow(rges.ic50.test)
residuals = rges.ic50.test$IC50.value - pred
rmse.test = sqrt(1/n * sum(residuals^2))
rmse.test
```
